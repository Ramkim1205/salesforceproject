public with sharing class TechnicianDashboardHelper {
    @AuraEnabled(cacheable=true)
    public static List<Installation__c> getTechnicianInstallations() {
        try {
            // í˜„ì¬ ë¡œê·¸ì¸í•œ User ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            Id userId = UserInfo.getUserId();
            System.debug('ğŸ”¹ Current Logged-in User ID: ' + userId);
            
            // í˜„ì¬ Userì™€ ì—°ê²°ëœ Technician ì¡°íšŒ
            List<Technician__c> technicianList = [
                SELECT Id FROM Technician__c WHERE User__c = :userId LIMIT 1
            ];
            
            // Technicianì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
            if (technicianList.isEmpty()) {
                System.debug('âš ï¸ No Technician found for User: ' + userId);
                return new List<Installation__c>();
            }
            
            Id technicianId = technicianList[0].Id;
            System.debug('âœ… Found Technician ID: ' + technicianId);
            
            // Technicianì´ ë³´ìœ í•œ Installation ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
            List<Installation__c> installations = [
                SELECT Id, Opportunity__c, Opportunity__r.Name, Scheduled_Date__c, Scheduled_Time__c, Status__c
                FROM Installation__c
                WHERE Technician__c = :technicianId
                ORDER BY Scheduled_Date__c ASC, Scheduled_Time__c ASC
            ];
            
            System.debug('âœ… Found Installations: ' + installations.size());
            return installations;
            
        } catch (Exception e) {
            System.debug('âŒ Error in getTechnicianInstallations: ' + e.getMessage());
            return new List<Installation__c>();
        }
    }
}